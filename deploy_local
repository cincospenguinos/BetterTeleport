#/usr/bin/env bash
#
# deploy_local
#
# Deploys the plugin locally to test

spigot_dir=$HOME/Spigot
mc_jar=$HOME/Spigot/Minecraft.jar

cp out/artifacts/BetterTeleport_jar/BetterTeleport.jar $spigot_dir/plugins
cd $spigot_dir
screen -dmS minecraft java -Xms512M -Xmx1G -XX:MaxPermSize=128M -XX:+UseConcMarkSweepGC -jar $spigot_dir/spigot.jar

loaded=`grep "BetterTeleport" $spigot_dir/logs/latest.log`
sleep 2
if [[ $loaded == *"Could not load 'plugins/BetterTeleport.jar'"* ]]
then
    echo "Plugin could not be loaded!"
    echo `grep "Exception" $spigot_dir/logs/latest.log`
    screen -X -S minecraft quit
else
    java -jar $mc_jar &> /dev/null
    screen -S minecraft -p 0 -X stuff "stop$(printf \\r)"
fi